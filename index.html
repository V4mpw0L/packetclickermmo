<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Packet Clicker!</title>
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover, user-scalable=no, shrink-to-fit=no"
        />
        <meta name="format-detection" content="telephone=no" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta name="apple-touch-fullscreen" content="yes" />
        <meta name="mobile-web-app-capable" content="yes" />

        <!-- PWA / SEO / SOCIAL META -->
        <link rel="manifest" href="manifest.json" />
        <meta name="theme-color" content="#161a22" />
        <meta
            name="description"
            content="Packet Clicker ‚Äì Cyberpunk idle clicker MMO for web and mobile. Evolve, earn gems, collect skins, compete and have fun!"
        />
        <meta property="og:title" content="Packet Clicker" />
        <meta
            property="og:description"
            content="Cyberpunk idle MMO game: evolve, earn gems, compete, unlock skins and more!"
        />
        <meta property="og:image" content="src/assets/packet-512.png" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://seusite.com/" />
        <!-- Update to your real site -->
        <link
            rel="icon"
            href="src/assets/packet-32.png"
            sizes="32x32"
            type="image/png"
        />
        <link
            rel="icon"
            href="src/assets/packet-48.png"
            sizes="48x48"
            type="image/png"
        />
        <link
            rel="icon"
            href="src/assets/packet-64.png"
            sizes="64x64"
            type="image/png"
        />
        <link
            rel="icon"
            href="src/assets/packet-512.png"
            sizes="512x512"
            type="image/png"
        />
        <link rel="apple-touch-icon" href="src/assets/packet-512.png" />

        <!-- Custom CSS only - no external dependencies -->
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <!-- Top Navigation Bar -->
        <nav class="top-bar" role="navigation" aria-label="Main navigation">
            <div class="user-info">
                <img
                    id="avatar"
                    src="https://api.dicebear.com/8.x/bottts-neutral/svg?seed=Hacker"
                    alt="Player avatar"
                    draggable="false"
                />
                <span id="player-name">Player</span>
                <span id="vip-badge"></span>
            </div>
            <div class="controls">
                <span id="gem-display">
                    <img
                        src="src/assets/gem.png"
                        alt="Gems"
                        style="
                            height: 1.1rem;
                            width: 1.1rem;
                            vertical-align: middle;
                            display: inline-block;
                        "
                        aria-hidden="true"
                    />
                    <span id="gem-count">0</span>
                </span>
                <button
                    id="open-settings"
                    title="Settings"
                    aria-label="Open settings"
                >
                    ‚öôÔ∏è
                </button>
            </div>
        </nav>

        <!-- Tab Menu Bar -->
        <nav class="menu-bar" role="tablist" aria-label="Game sections">
            <button
                class="tab-btn"
                data-tab="game"
                role="tab"
                aria-label="Game"
                title="Game"
            >
                üïπÔ∏è
            </button>
            <button
                class="tab-btn"
                data-tab="upgrades"
                role="tab"
                aria-label="Upgrades"
                title="Upgrades"
            >
                üõ†Ô∏è
            </button>
            <button
                class="tab-btn"
                data-tab="achievements"
                role="tab"
                aria-label="Achievements"
                title="Achievements"
            >
                üéØ
            </button>
            <button
                class="tab-btn"
                data-tab="shop"
                role="tab"
                aria-label="Shop"
                title="Shop"
            >
                üè¨
            </button>
            <button
                class="tab-btn"
                data-tab="boosts"
                role="tab"
                aria-label="Boosts"
                title="Boosts"
            >
                ‚ö°
            </button>
            <button
                class="tab-btn"
                data-tab="themes"
                role="tab"
                aria-label="Themes"
                title="Themes"
            >
                üé®
            </button>
            <button
                class="tab-btn"
                data-tab="prestige"
                role="tab"
                aria-label="Prestige"
                title="Prestige"
            >
                ‚≠ê
            </button>
            <button
                class="tab-btn"
                data-tab="daily"
                role="tab"
                aria-label="Daily"
                title="Daily"
            >
                üìÖ
            </button>
            <button
                class="tab-btn"
                data-tab="leaderboard"
                role="tab"
                aria-label="Leaderboard"
                title="Leaderboard"
            >
                üèÜ
            </button>
        </nav>

        <!-- Main Content / Tabs -->
        <main id="tab-content" role="main" aria-live="polite"></main>

        <!-- Modals: Profile & Settings -->
        <div id="modal-backdrop" class="modal-backdrop hidden">
            <div
                id="modal"
                class="modal-box hidden"
                role="dialog"
                aria-modal="true"
                tabindex="-1"
                aria-labelledby="modal-title"
            ></div>
        </div>

        <!-- HUD notification (injected by JS) -->

        <footer role="contentinfo">
            <div
                style="
                    display: flex;
                    gap: 0.5rem;
                    align-items: center;
                    justify-content: center;
                    flex-wrap: wrap;
                "
            >
                <span
                    >Packet Clicker &copy; 2025 | Developed by:
                    <a
                        href="https://www.gennisys.com"
                        target="_blank"
                        rel="noopener"
                        style="
                            color: #00ff41;
                            text-decoration: none;
                            font-weight: bold;
                        "
                        >Gennisys</a
                    >
                </span>
                <span
                    id="version-badge"
                    title="App version"
                    style="
                        display: inline-flex;
                        align-items: center;
                        gap: 0.35rem;
                        padding: 0.15rem 0.5rem;
                        border: 1px solid var(--primary-color);
                        color: var(--primary-color);
                        border-radius: 8px;
                        font-weight: 700;
                        font-size: 0.85rem;
                        background: linear-gradient(
                            135deg,
                            var(--bg-secondary),
                            var(--bg-card)
                        );
                        box-shadow: 0 2px 10px var(--shadow-primary);
                    "
                >
                    <span>Version</span><strong>0.0.1</strong>
                </span>
            </div>
        </footer>

        <!-- Constants (UMD) -->
        <script src="src/data/constants.js"></script>
        <!-- Storage (UMD) -->
        <script src="src/utils/storage.js"></script>
        <!-- Modular helpers (non-invasive) -->
        <script src="src/ui/ui.js"></script>
        <script src="src/logic/bootstrap.js"></script>

        <!-- Main Game Logic -->
        <script src="main.js"></script>

        <!-- PWA: Register Service Worker -->
        <script>
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker
                    .register("service-worker.js")
                    .then(function (reg) {
                        const hasController =
                            !!navigator.serviceWorker.controller;
                        // Only request skipWaiting once per session and only when updating an existing SW
                        const alreadySkipped =
                            sessionStorage.getItem("sw-skip") === "1";
                        if (reg.waiting && hasController && !alreadySkipped) {
                            reg.waiting.postMessage({ type: "SKIP_WAITING" });
                            sessionStorage.setItem("sw-skip", "1");
                        }

                        // Listen for a new worker and activate it once per session when updating
                        reg.addEventListener("updatefound", function () {
                            const newWorker = reg.installing;
                            if (!newWorker) return;
                            newWorker.addEventListener(
                                "statechange",
                                function () {
                                    if (
                                        newWorker.state === "installed" &&
                                        hasController &&
                                        sessionStorage.getItem("sw-skip") !==
                                            "1"
                                    ) {
                                        newWorker.postMessage({
                                            type: "SKIP_WAITING",
                                        });
                                        sessionStorage.setItem("sw-skip", "1");
                                    }
                                },
                            );
                        });

                        // Update check disabled to avoid redundant updates
                    });

                // Guarded one-time reload when the new service worker takes control
                navigator.serviceWorker.addEventListener(
                    "controllerchange",
                    function () {
                        if (sessionStorage.getItem("sw-reloaded") === "1")
                            return;
                        sessionStorage.setItem("sw-reloaded", "1");
                        window.location.reload();
                    },
                );
            }
        </script>
    </body>
</html>
